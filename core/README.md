# TitanChain Core 包说明文档

## 文件结构说明

### block.go
实现了区块链中区块的核心数据结构和相关功能：
- `Header`: 区块头结构，包含版本号、数据哈希、前块哈希、高度和时间戳
- `Block`: 完整区块结构，包含区块头、交易列表（指针切片）、验证者公钥和签名
- 主要功能：
  - 区块创建（`NewBlock`、`NewBlockFromPrevHeader`，交易列表类型为`[]*Transaction`）
  - 区块签名与验证
  - 区块编码/解码
  - 区块哈希计算
  - 交易添加（`AddTransaction`，支持指针类型）
  - 交易数据哈希计算（`CalculateDataHash`，支持指针类型）

### blockchain.go
实现了区块链的核心功能：
- `Blockchain`: 区块链结构，管理区块的存储和验证
- 主要功能：
  - 区块链初始化
  - 区块添加和验证
  - 区块高度与区块头查询
  - 验证器管理

### transaction.go
实现了交易相关的数据结构和功能：
- `Transaction`: 交易结构，包含数据、公钥、签名、哈希
- 主要功能：
  - 交易签名与验证
  - 交易哈希计算（带缓存）
  - 交易序列化与反序列化

### validator.go
实现了区块验证相关的功能：
- `Validator`: 验证器接口定义
- `BlockValidator`: 基本的区块验证器实现
- 主要功能：
  - 区块高度验证
  - 前区块哈希验证
  - 区块签名验证
  - 可扩展的验证规则框架

### storage.go
实现了区块存储相关的功能：
- `Storage`: 存储接口定义
- `MemoryStore`: 基于内存的存储实现
- 主要功能：
  - 区块存储接口抽象
  - 内存存储的基本实现

### encoding.go
定义了通用的编码/解码接口和 gob 编解码实现：
- `Encoder`/`Decoder`: 通用接口，支持任意类型的数据序列化和反序列化
- `GobTxEncoder`/`GobTxDecoder`: 基于 gob 的交易编码器/解码器，支持交易的高效二进制序列化
- 主要功能：
  - 交易的 gob 编码与解码
  - 支持自定义类型注册

### hasher.go
实现了哈希计算相关的功能：
- `Hasher`: 通用哈希计算接口
- `BlockHasher`: 区块头哈希计算（SHA256）
- `TxHasher`: 交易哈希计算（SHA256）
- 主要功能：
  - 区块头和交易的哈希计算
  - 支持自定义哈希器

### block_test.go
区块相关的单元测试：
- 测试区块签名与验证
- 辅助生成随机区块

### blockchain_test.go
区块链核心功能的单元测试：
- 测试区块批量添加、区块高度、区块头获取、分叉与跳跃高度等场景
- 辅助函数生成带创世区块的链和前区块哈希

### transaction_test.go
交易相关的单元测试：
- 测试交易签名与验证
- 测试交易序列化与反序列化
- 辅助生成带签名的交易

## 完整功能说明
- 支持区块和交易的签名与验证，保证数据完整性和不可抵赖性
- 支持区块链的高度、区块头、区块添加、分叉检测等核心操作
- 支持区块存储接口抽象，便于后续扩展持久化存储
- 支持区块和交易的单元测试，保证核心逻辑正确性
- 支持交易的高效序列化、哈希、优先级管理
- 代码结构清晰，便于后续模块化扩展

## 测试覆盖点
- 区块签名与验证的正确性
- 区块链批量添加、分叉、跳跃高度等边界场景
- 交易签名、验证、序列化与反序列化
- 存储接口的抽象与内存实现
- 哈希与编码器的正确性

## 后续开发计划

### 近期计划（1-2周）
1. 完善区块结构
   - 支持区块内交易的并行验证与执行
   - 优化区块头与数据哈希的计算逻辑，适配指针类型交易列表
   - 增强区块签名与多重签名支持
2. 完善存储系统
   - 实现持久化存储（如LevelDB/BadgerDB）
   - 添加区块索引与高效查询
   - 实现区块缓存机制
3. 增强验证系统
   - 添加更多交易验证规则
   - 实现区块时间戳、大小、双花检测等
   - 支持多种共识规则的验证器
4. 区块链核心优化
   - 实现分叉处理与区块回滚
   - 优化区块同步与孤儿块处理
5. 交易与序列化
   - 支持多种编码格式（如Protobuf）
   - 优化交易池与区块打包逻辑
   - 增强交易哈希缓存与高效查重机制

### 中期计划（1-2月）
1. 共识机制
   - 实现PoS/BFT等共识
   - 验证者管理与惩罚机制
   - 质押与投票功能
2. 状态管理
   - 实现Merkle Patricia Trie
   - 状态快照与回滚
   - 状态压缩与高效存储
3. 网络层
   - 实现P2P通信、节点发现、区块/交易广播
   - 网络同步优化
   - 支持多格式消息序列化

### 长期计划（3-6月）
1. 智能合约
   - 实现VM、合约部署与执行、Gas计费
   - 合约升级与权限管理
2. 性能优化
   - 并行交易处理、分片、缓存层
   - 存储与网络性能提升
3. 安全性增强
   - 多种加密算法、权限控制、数据隐私保护
   - 审计与安全监控
   - 增强模块化与可插拔性

## 注意事项
1. 所有新增代码必须包含完整的单元测试
2. 保持代码风格一致，遵循Go的编码规范
3. 确保向后兼容性
4. 及时更新文档
5. 关注性能优化
6. 重视安全性设计 