# Network 包

这个包实现了 TitanChain 区块链的网络通信层，提供了节点间通信的基础设施。

## 文件说明

### transport.go
定义了网络传输的核心接口和基础类型：
- `NetAddr`: 网络地址类型
- `RPC`: 远程过程调用的消息结构
- `Transport`: 网络传输接口，定义了节点间通信的基本方法

### local_transport.go
实现了用于本地测试的传输层：
- `LocalTransport`: 本地网络传输的具体实现
- 支持特性：
  - 点对点通信
  - 消息超时机制
  - 最大连接数限制
  - 线程安全的操作
  - 优雅关闭机制
- 主要功能：
  - 建立节点间连接
  - 发送和接收消息
  - 管理对等节点
  - 错误处理

### server.go
实现了区块链网络服务器：
- `Server`: 网络服务器的核心实现
- 功能特性：
  - 支持多传输层
  - 异步消息处理
  - 定时任务执行
  - 优雅关闭机制
- 主要职责：
  - 初始化传输层
  - 处理网络消息
  - 管理服务生命周期
  - 管理内存交易池

### txpool.go
实现了内存交易池：
- `TxPool`: 交易池结构，支持交易的添加、去重、排序、清空等操作
- `TxMapSorter`: 交易排序器，按 firstSeen 字段排序
- 主要功能：
  - 交易池管理
  - 交易优先级排序
  - 并发安全

### local_transport_test.go
包含了本地传输实现的单元测试：
- 测试连接建立和断开
- 测试消息发送和接收
- 测试并发操作
- 测试错误处理
- 测试边界条件

### txpool_test.go
交易池相关的单元测试：
- 测试交易池初始化、添加、去重、清空
- 测试交易排序

## 核心功能

### 网络通信
- 支持点对点通信
- 异步消息处理
- 可靠的消息传递
- 超时机制

### 节点管理
- 动态节点发现
- 连接数限制
- 节点状态监控
- 连接生命周期管理

### 交易池管理
- 支持高效的内存交易池
- 交易优先级排序
- 并发安全

### 错误处理
- 自定义错误类型
- 超时处理
- 连接错误处理
- 优雅降级

## 使用示例

```go
// 创建本地传输实例
transport := NewLocalTransport(LocalTransportOpts{
    Addr:     "node1",
    MaxPeers: 10,
    Timeout:  5 * time.Second,
})

// 创建服务器
server := NewServer(ServerOpts{
    Transports: []Transport{transport},
})

// 启动服务器
server.Start()
```

## 后续开发计划
### 近期计划（1-2周）
1. 添加 TCP/UDP 传输实现
2. 实现节点发现与自动连接
3. 支持消息加密和认证
4. 优化交易池并发性能
5. 增强网络监控和统计

### 中期计划（1-2月）
1. 实现 P2P 网络拓扑与分层路由
2. 支持跨链通信协议
3. 网络层与共识层集成
4. 交易池与区块链状态联动

### 长期计划（3-6月）
1. 网络层安全加固（抗DDoS、抗Sybil）
2. 网络协议升级与兼容性支持
3. 网络层性能极致优化
4. 支持多种网络环境（NAT、IPv6等）